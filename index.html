<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord voyage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        header {
            background: #003366;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        main {
            max-width: 900px;
            margin: auto;
            padding: 1rem;
        }
        section {
            background: white;
            border: 1px solid #ccc;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        h2 {
            margin-top: 0;
        }
        ul {
            padding-left: 1.2rem;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
        th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
        input, select, button, textarea { margin-top: 0.5rem; }
    </style>
</head>
<body>
<header>
    <h1>Mon tableau de bord</h1>
</header>
<main>
    <section id="dashboard">
        <h2>Dashboard</h2>
        <div>
            <strong>Météo à Bangkok:</strong> <span id="weather-content">--</span>
        </div>
        <div>
            <strong>Jours avant départ:</strong> <span id="days-left">--</span>
        </div>
        <div>
            <strong>Prochains événements:</strong>
            <ul id="events"></ul>
        </div>
        <div>
            <strong>Solde de trésorerie:</strong> <span id="cash-balance">--</span>
        </div>
    </section>

    <section id="voyage">
        <h2>Voyage</h2>
        <ul>
            <li>Suivi des billets d'avion (import manuel ou via e-mail)</li>
            <li>Notifications de changements de vol</li>
            <li>Détail des étapes : escales, horaires, compagnies</li>
        </ul>
    </section>


    <section id="finance">
        <h2>Finance</h2>
        <div>
            <label>Solde au <input type="date" id="balance-date"></label>
            <input type="number" id="initial-balance" placeholder="Solde initial">
            <button id="set-balance">Définir</button>
        </div>
        <div id="finance-input">
            <h3>Saisie</h3>
            <label>Date: <input type="date" id="entry-date"></label>
            <label>Type:
                <select id="entry-type">
                    <option value="depense">Dépense</option>
                    <option value="recette">Recette</option>
                </select>
            </label>
            <label>Libellé: <input type="text" id="entry-label"></label>
            <label>Montant: <input type="number" id="entry-amount"></label>
            <button id="add-entry">Ajouter</button>
        </div>
        <table id="finance-table">
            <thead>
                <tr><th>Date</th><th>Type</th><th>Libellé</th><th>Montant</th></tr>
            </thead>
            <tbody></tbody>
        </table>
        <div>Solde actuel: <span id="current-balance">0</span> €</div>
        <div class="currency-converter">
            <h3>Convertisseur de devise</h3>
            <input type="number" id="conv-amount" value="1">
            <select id="conv-from"></select>
            <span>→</span>
            <select id="conv-to"></select>
            <button id="convert-currency">Convertir</button>
            <div id="conv-result"></div>
        </div>
    </section>

    <section id="notes">
        <h2>Notes</h2>
        <textarea id="note-text" rows="4" cols="50" placeholder="Votre note..."></textarea><br>
        <button id="export-note">Exporter la note</button>
    </section>

    <section id="liens">
        <h2>Liens utiles</h2>
        <ul>
            <li><a href="https://www.banque-france.fr" target="_blank">Banque de France</a></li>
            <li><a href="https://www.xe.com" target="_blank">Convertisseur XE</a></li>
            <li><a href="https://www.investopedia.com" target="_blank">Investopedia</a></li>
            <li><a href="https://travel.state.gov" target="_blank">Conseils aux voyageurs</a></li>
        </ul>
    </section>
    <section id="actualites">
        <h2>Actualités Asie</h2>
        <p>Flux RSS configurable par l'utilisateur.</p>
    </section>

    <section id="agenda">
        <h2>Agenda</h2>
        <ul>
            <li>Synchronisation avec votre calendrier Apple</li>
            <li>Ajout, modification et suppression d'événements</li>
        </ul>
    </section>

    <section id="applications">
        <h2>Applications recommandées</h2>
        <p>Liste interactive d'apps utiles (Google Maps, Wise, Revolut…)</p>
    </section>

    <section id="langue">
        <h2>Langue</h2>
        <ul>
            <li>Mini dictionnaire hors-ligne ou accès rapide à une API de traduction</li>
            <li>Phrases essentielles pré-enregistrées</li>
        </ul>
    </section>

    <section id="documents">
        <h2>Documents</h2>
        <ul>
            <li>Stockage sécurisé (visa, passeport, assurance) avec chiffrement local</li>
        </ul>
    </section>
    <section id="fichiers">
        <h2>Gestion des fichiers</h2>
        <button id="choose-dir">Choisir dossier principal</button>
        <input type="file" id="file-input" multiple style="display:none;">
        <button id="import-files" disabled>Importer des fichiers</button>
        <div id="file-status"></div>
    </section>

    <section id="offline">
        <h2>Mode hors-ligne</h2>
        <p>Accès aux informations critiques même sans internet.</p>
    </section>

    <section id="urgence">
        <h2>Bouton Urgence</h2>
        <p>
            Accès rapide aux numéros d'urgence et à un message pré-rempli pour vos contacts.
        </p>
    </section>

    <section id="sante">
        <h2>Santé et sécurité</h2>
        <ul>
            <li>Liste des hôpitaux recommandés, vaccins requis, pharmacies proches</li>
            <li>Informations médicales à compléter par l'utilisateur</li>
        </ul>
    </section>

    <section id="humeur">
        <h2>Humeur / Journal express</h2>
        <p>Noter rapidement votre état émotionnel du jour.</p>
    </section>

    <section id="parametres">
        <h2>Paramètres</h2>
        <ul>
            <li>Personnalisation des notifications</li>
            <li>Mode sombre / clair</li>
            <li>Réinitialisation des données</li>
            <li>Import/export de sauvegarde</li>
        </ul>
    </section>
</main>
</body>
<script>
const departureDate = new Date('2024-12-01');
const events = [
    { date: '2024-06-10', title: 'Réserver logement' },
    { date: '2024-06-20', title: 'Vaccination' }
];
let entries = JSON.parse(localStorage.getItem('financeEntries') || '[]');
let currentBalance = parseFloat(localStorage.getItem('currentBalance') || '0');

async function updateWeather() {
    const city = 'Bangkok';
    const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}`;
    const geoResponse = await fetch(geoUrl);
    const geoData = await geoResponse.json();
    if (!geoData.results || geoData.results.length === 0) {
        document.getElementById('weather-content').innerText = 'Ville non trouvée';
        return;
    }
    const { latitude, longitude } = geoData.results[0];
    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
    const weatherResponse = await fetch(weatherUrl);
    const weatherData = await weatherResponse.json();
    if (weatherData && weatherData.current_weather) {
        const w = weatherData.current_weather;
        document.getElementById('weather-content').innerText = `Température: ${w.temperature}°C, Vent: ${w.windspeed} km/h`;
    }
}

function updateCountdown() {
    const today = new Date();
    const diff = Math.ceil((departureDate - today) / (1000 * 60 * 60 * 24));
    document.getElementById('days-left').innerText = diff;
}

function loadEvents() {
    const list = events.map(e => `<li>${e.date} - ${e.title}</li>`).join('');
    document.getElementById('events').innerHTML = list;
}

function renderFinance() {
    const tbody = document.getElementById('finance-table').querySelector('tbody');
    tbody.innerHTML = entries.map(e => `<tr><td>${e.date}</td><td>${e.type}</td><td>${e.label}</td><td>${e.amount.toFixed(2)}</td></tr>`).join('');
    document.getElementById('current-balance').innerText = currentBalance.toFixed(2);
}

function setInitialBalance() {
    const amount = parseFloat(document.getElementById('initial-balance').value || '0');
    currentBalance = amount;
    entries = [];
    localStorage.setItem('currentBalance', currentBalance);
    localStorage.setItem('financeEntries', JSON.stringify(entries));
    renderFinance();
}

function addEntry() {
    const date = document.getElementById('entry-date').value;
    const type = document.getElementById('entry-type').value;
    const label = document.getElementById('entry-label').value;
    const amount = parseFloat(document.getElementById('entry-amount').value || '0');
    const signed = type === 'depense' ? -amount : amount;
    currentBalance += signed;
    entries.push({date, type, label, amount: signed});
    localStorage.setItem('currentBalance', currentBalance);
    localStorage.setItem('financeEntries', JSON.stringify(entries));
    renderFinance();
}

document.getElementById('set-balance').addEventListener('click', setInitialBalance);
document.getElementById('add-entry').addEventListener('click', addEntry);

function populateCurrencies() {
    const list = ['EUR','USD','GBP','JPY','THB'];
    const from = document.getElementById('conv-from');
    const to = document.getElementById('conv-to');
    list.forEach(c => {
        const opt1 = document.createElement('option');
        opt1.value = opt1.text = c;
        from.appendChild(opt1.cloneNode(true));
        const opt2 = document.createElement('option');
        opt2.value = opt2.text = c;
        to.appendChild(opt2);
    });
    from.value = 'EUR';
    to.value = 'USD';
}

async function convertCurrency() {
    const amount = parseFloat(document.getElementById('conv-amount').value || '0');
    const from = document.getElementById('conv-from').value;
    const to = document.getElementById('conv-to').value;
    const url = `https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`;
    try {
        const res = await fetch(url);
        const data = await res.json();
        if (data && data.result) {
            document.getElementById('conv-result').innerText = data.result.toFixed(2);
        }
    } catch(e) {
        document.getElementById('conv-result').innerText = 'Erreur conversion';
    }
}
let rootDirHandle;
let docsDirHandle;

async function chooseDirectory() {
    try {
        const handle = await window.showDirectoryPicker();
        rootDirHandle = await handle.getDirectoryHandle("DASH", { create: true });
        docsDirHandle = await rootDirHandle.getDirectoryHandle("documents", { create: true });
        document.getElementById("file-status").innerText = "Dossier prêt";
        document.getElementById("import-files").disabled = false;
    } catch (e) {
        document.getElementById("file-status").innerText = "Échec sélection dossier";
    }
}

async function importFiles() {
    if (!docsDirHandle) return;
    const input = document.getElementById("file-input");
    input.onchange = async () => {
        const files = Array.from(input.files);
        for (const file of files) {
            const fh = await docsDirHandle.getFileHandle(file.name, { create: true });
            const writable = await fh.createWritable();
            await writable.write(file);
            await writable.close();
        }
        document.getElementById("file-status").innerText = files.length + " fichier(s) importé(s)";
        input.value = "";
    };
    input.click();
}

document.getElementById("choose-dir").addEventListener("click", chooseDirectory);
document.getElementById("import-files").addEventListener("click", importFiles);


document.getElementById('convert-currency').addEventListener('click', convertCurrency);
document.getElementById('export-note').addEventListener('click', () => {
    const text = document.getElementById('note-text').value;
    const date = new Date().toISOString().slice(0,10);
    const blob = new Blob([text], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `note-${date}.txt`;
    a.click();
    URL.revokeObjectURL(a.href);
});

populateCurrencies();
updateWeather();
updateCountdown();
loadEvents();
renderFinance();
</script>
</body>
</html>
